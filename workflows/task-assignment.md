# Workflow: Task Assignment & Execution

## 完整流程

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 需求接收 (User → Helix)                                  │
│    "我要做一个用户系统"                                       │
└──────────────────────┬──────────────────────────────────────┘
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. 任务拆分 (Helix)                                          │
│    - 拆成子任务 (<4000 tokens each)                          │
│    - 标记优先级                                              │
│    - 分配 assignee                                           │
└──────────────────────┬──────────────────────────────────────┘
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. 派发 (Helix → Subagent)                                  │
│    - Codex: 代码类                                          │
│    - Researcher: 调研类                                      │
│    - 检查并发限制                                            │
└──────────────────────┬──────────────────────────────────────┘
                       ▼
         ┌─────────────┴─────────────┐
         ▼                             ▼
┌─────────────────┐         ┌─────────────────┐
│ Codex 执行      │         │ Researcher 调研 │
│ - 读取 TODO    │         │ - 读取任务      │
│ - Clarify      │         │ - 搜索/分析     │
│ - 执行         │         │ - 写报告        │
│ - 自检         │         │ - 自检          │
│ - commit       │         │ - 归档          │
└────────┬────────┘         └────────┬────────┘
         │                            │
         └─────────────┬──────────────┘
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. 验收 (Helix)                                             │
│    - 对照需求逐项检查                                        │
│    - 通过 → 标记 done                                        │
│    - 失败 → 记录问题，重新派发                               │
└──────────────────────┬──────────────────────────────────────┘
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. 反馈 (Helix → User)                                      │
│    "搞定！PR 在这里..."                                      │
└─────────────────────────────────────────────────────────────┘
```

## 并发控制

| Agent | 最大并发 | 原因 |
|-------|----------|------|
| Codex | 2 | 代码修改有冲突风险 |
| Researcher | 3 | 调研相对独立 |

## Context 保护

- **预警线**: 3000 tokens
- **硬限**: 4000 tokens
- **超过**: 暂停派发，等清空

## 阻塞处理

1. Agent 超过 30 分钟无响应 → 标记阻塞
2. Helix 尝试重新派发
3. 仍失败 → 通知用户

---

**核心**: 清晰拆分 → 有限并发 → 严格验收
