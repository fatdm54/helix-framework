# Agent Ecosystem - 完整闭环

## 架构图

```
                          ┌──────────────────────────────────────┐
                          │         Helix (CEO)                 │
                          │    战略决策 + 任务分发 + 验收         │
                          └──────────────────┬───────────────────┘
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
          ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
          │     Codex       │     │   Researcher    │     │   Scheduler    │
          │   首席开发者     │     │   首席调研员     │     │   资源协调员    │
          │                 │     │                 │     │                 │
          │ • 代码实现      │     │ • 调研分析       │     │ • 负载监控      │
          │ • 自测验证      │     │ • 报告输出       │     │ • 任务队列      │
          │ • 自我复盘      │     │ • 知识归档       │     │ • 瓶颈识别      │
          └────────┬────────┘     └────────┬────────┘     └────────┬────────┘
                   │                       │                       │
                   └───────────────────────┼───────────────────────┘
                                           │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
          ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
          │    Reviewer    │     │     Tester     │     │   Documenter   │
          │   代码审查员    │     │   测试工程师    │     │   文档工程师    │
          │                │     │                │     │                 │
          │ • 代码审查     │     │ • 测试编写     │     │ • 文档编写      │
          │ • 规范检查     │     │ • 缺陷报告     │     │ • 知识整理      │
          │ • 风险识别     │     │ • 覆盖率分析   │     │ • 可读性优化    │
          └─────────────────┘     └─────────────────┘     └─────────────────┘
                    │                        │                        │
                    └────────────────────────┼────────────────────────┘
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
          ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
          │    Evaluator    │     │    Learning     │     │    Guardian    │
          │   自检评估员    │     │   进化工程师    │     │   安全守护者    │
          │                │     │                │     │                 │
          │ • 任务评估     │     │ • 经验收集     │     │ • 安全扫描      │
          │ • Agent 考核   │     │ • 模式识别     │     │ • 异常检测      │
          │ • 流程审计     │     │ • 流程优化     │     │ • 健康监控      │
          └─────────────────┘     └─────────────────┘     └─────────────────┘
                    │                        │                        │
                    └────────────────────────┼────────────────────────┘
                                             │
                                    ┌────────▼────────┐
                                    │   知识库        │
                                    │  Knowledge     │
                                    │                │
                                    │ • patterns/    │
                                    │ • lessons/     │
                                    │ • best-practices/
                                    └────────┬────────┘
                                             │
                              ┌──────────────┴──────────────┐
                              │     闭环完成 → 再次循环       │
                              └─────────────────────────────┘
```

## 任务流转

### 完整流程

```
1. 用户需求 → Helix 理解
         ↓
2. Helix 拆分任务 → Scheduler 检查负载
         ↓
3. 派发给 Agent (Codex/Researcher/...)
         ↓
4. Agent 执行 + 自检
         ↓
5. Reviewer 审查 + Tester 测试
         ↓
6. Evaluator 评估质量
         ↓
7. Documenter 更新文档
         ↓
8. Guardian 安全检查
         ↓
9. Learning 收集经验 → 更新知识库
         ↓
10. Helix 验收 → 反馈用户
         ↓
11. 循环优化 ← 回到步骤 1
```

## 职责矩阵

| Agent | 输入 | 输出 | 上游 | 下游 |
|-------|------|------|------|------|
| Helix | 用户需求 | 任务列表 | 用户 | 所有执行 Agent |
| Codex | 任务 spec | 代码 + 测试 | Helix | Reviewer, Tester |
| Researcher | 调研问题 | 调研报告 | Helix | Documenter |
| Scheduler | 任务队列 | 负载报告 | Helix | Helix |
| Reviewer | PR/代码 | 审查意见 | Codex | Evaluator |
| Tester | 代码 | 测试报告 | Codex | Evaluator |
| Documenter | 任务产出 | 文档 | Researcher | Guardian |
| Evaluator | 任务结果 | 评估报告 | Reviewer/Tester | Learning |
| Learning | 评估数据 | 改进建议 | Evaluator | 所有 Agent |
| Guardian | 系统状态 | 安全报告 | 所有 Agent | Helix |

## 隔离原则

### Context 隔离

- 每个 Agent 独立 context
- 任务切换时清理状态
- 长任务强制拆分

### 职责隔离

- 执行 ≠ 审查
- 开发 ≠ 测试
- 建议 ≠ 决策

### 资源隔离

- 并发限制
- 超时保护
- 负载均衡

## 防幻觉机制

1. **多角色验证**: 代码 Reviewer + Tester + Evaluator
2. **证据要求**: Researcher 必须带来源
3. **自检机制**: 每个 Agent 完成后自检
4. **知识库校验**: 重要决策查知识库

## 自我进化

```
任务 → 执行 → 复盘 → 经验 → 知识库 → 新任务 → 更强执行
                 ↑                              │
                 └──────────────────────────────┘
```

### 进化来源

- **成功模式**: 识别高效工作方式
- **失败教训**: 记录踩坑经历
- **外部学习**: Researcher 调研新方法
- **系统优化**: Learning Agent 分析

---

**这就是我们要的 Agent 生态圈 - 自闭环、可持续进化**
